<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SUN NN</title>
</head>

<body>
	<div id="container">
	</div>

	<input type="range" min="0" max="10" step="0.1" oninput="">
	<input type="range" min="0" max="10" step="0.1" oninput="">
	<input type="range" min="0" max="10" step="0.1" oninput="">

	</br>
	<input type="range" min="0" max="1" step="1" oninput="changeValue1(this.value)">
	<input type="range" min="0" max="1" step="1" oninput="changeValue2(this.value)">
</body>

<style>
	body {
		margin: 0px;
		height: 100%;
		width: 100%;
		background-color: rgb(255, 255, 255);
	}

	#container {
		width: 100%;
		/* height: 100%; */
		padding: auto;
		background-color: rgb(255, 255, 255);
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
	}

	#container>canvas {
		/* width: 500px; */
		height: 100%;
		/* width: 100%; */
		/* height: 500px; */
	}
</style>

<script type="module">
	import * as SUN from './GBsun.js'
	import * as NN from './SUN_NN.js'

	window.changeValue1 = function (val) {
		i1.set_Value(val);
		NN.forward(ns);
	}
	window.changeValue2 = function (val) {
		i2.set_Value(val);
		NN.forward(ns);
	}

	let gameconsole = new SUN.sunConsole(500, 280, true)

	document.getElementById('container').appendChild(gameconsole.get_ConsoleDOM())

	const Font = SUN.Font.DEFAULT()

	const Color = {
		0: SUN.Color.PICO(0),
		1: SUN.Color.PICO(1),
		2: SUN.Color.PICO(2),
		3: SUN.Color.PICO(3),
		4: SUN.Color.PICO(4),
		5: SUN.Color.PICO(5),
		6: SUN.Color.PICO(6),
		7: SUN.Color.PICO(7),
		8: SUN.Color.PICO(8),
		9: SUN.Color.PICO(9),
		10: SUN.Color.PICO(10),
		11: SUN.Color.PICO(11),
		12: SUN.Color.PICO(12),
		13: SUN.Color.PICO(13),
		14: SUN.Color.PICO(14),
		15: SUN.Color.PICO(15)
	}

	const WHITE = SUN.Color.COLOR('white')
	const HIGHLIGHT = SUN.Color.PICO(10)
	const FUNCTION = SUN.Color.PICO(14)
	const TESTCOLOR = SUN.Color.RGB8(255, 255, 0, 20)

	// define a nn
	//input layer
	let i1 = new NN.Neuron('Input1', 0);
	let i2 = new NN.Neuron('Input2', 0);

	let out = new NN.Neuron('Out', 2, NN.STEP);

	i1.link(out, 5);
	i2.link(out, 5);

	let [ns, maxsize] = NN.get_NN([i1, i2, out]);

	let opt = new NN.Momentum(0.001, 0.9);
	opt.init(ns);

	gameconsole.init = (sc) => {
	}

	let train = false;
	gameconsole.action = (sc, delta) => {
		if (sc.Keyboard.keymap[' '] && sc.Keyboard.keymap[' '].once) {
			train = !train;
		}
	}

	gameconsole.render = (sc, delta) => {
		if (train) {
			let l = 0;
			for (let i = 0; i < 10; i++) {
				let a = Math.random();
				let b = Math.random();
				let c = (a + b) / 2;
				let [out, loss] = NN.backpropagation(ns, { 'Input1': a, 'Input2': b }, { 'Out': c }, opt);
				l = loss;
			}
			console.log(l);
		}
		NN.draw_NN(100, 90, 80, 80, 12, sc.Renderer, ns, maxsize);
	}

	gameconsole.run()
</script>

</html>